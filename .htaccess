# Force correct MIME types
AddType application/javascript .js
AddType text/css .css
AddType text/html .html
AddType application/json .json
AddType model/gltf-binary .glb
AddType video/mp4 .mp4
AddType image/png .png

# Disable PHP processing for static files
<FilesMatch "\.(js|css|html|json|glb|mp4|png)$">
    SetHandler default-handler
</FilesMatch>

# Allow CORS for assets
<FilesMatch "\.(js|css|glb|mp4|png)$">
    Header set Access-Control-Allow-Origin "*"
</FilesMatch>

RewriteEngine On

# Don't rewrite actual files and directories
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Handle SPA routing - only for non-existing paths
RewriteRule ^(?!assets/).*$ /index.html [L]

# Enable GZIP compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json
</IfModule>

# Set caching headers
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 year"
    ExpiresByType application/javascript "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType video/mp4 "access plus 1 year"
    ExpiresByType model/gltf-binary "access plus 1 year"
</IfModule>
